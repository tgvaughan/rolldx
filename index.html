<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="description" content="Simple dice roller.">
    
    <title>Roll dX</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
      button {
          font-size: 2em;
      }

      #roll-buttons {
          max-width: 100%;
      }

      #controls {
          margin-top: 1em;
          max-width: 100%;
      }

      #controls > button {
          padding-right: 1em;
          padding-left: 1em;
          margin-right: 1em;
      }

      body {
          text-align: center;
      }
    </style>

  </head>

  <body>

    <textarea id="output" rows="5" cols="50" readonly="true"></textarea>

    <div id="roll-buttons">
    <button data-die="2">d2</button>
    <button data-die="4">d4</button>
    <button data-die="6">d6</button>
    <button data-die="8">d8</button>
    <button data-die="10">d10</button>
    <button data-die="12">d12</button>
    <button data-die="20">d20</button>
    <button data-die="100">d&percnt;</button>
    </div>

    <div id="controls">
      <button id="equals">=</button>
      <button id="clear">Clear</button>
    </div>

  </body>

  <script>
    var current_sum = 0;

    const out = document.querySelector('#output');

    function roll(d) {
        return Math.ceil(Math.random()*d);
    }

    function roll_event(e) {
        if (e.target.tagName != "BUTTON")
            return false;

        var d = e.target.dataset.die*1;

        if (current_sum > 0)
            out.value += '+ ';

        var result = roll(d);
        current_sum += result;

        out.value += result + '[d' + d + '] ';
    }

    function clear() {
        current_sum = 0;
        out.value = '';
    }

    function equals() {
        if (current_sum == 0)
            return false;

        out.value += '= ' + current_sum + '\n';
        current_sum = 0;
    }

    document.querySelector('#roll-buttons').addEventListener('click', roll_event);
    document.querySelector('#clear').addEventListener('click', clear);
    document.querySelector('#equals').addEventListener('click', equals);
  </script>
</html>
