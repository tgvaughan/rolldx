<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="description" content="Simple dice roller.">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico">
    
    <title>Roll dX</title>


    <style>
      button {
          font-size: 2em;
      }

      #roll-buttons {
          max-width: 100%;
      }

      #controls {
          margin-top: 1em;
          max-width: 100%;
      }

      #controls > button {
          padding-right: 1em;
          padding-left: 1em;
          margin-right: 1em;
      }

      body {
          text-align: center;
      }
    </style>

  </head>

  <body>

    <textarea id="output" rows="5" cols="50" readonly="true"></textarea>

    <div id="roll-buttons">
    <button data-die="2">d2</button>
    <button data-die="4">d4</button>
    <button data-die="6">d6</button>
    <button data-die="8">d8</button>
    <button data-die="10">d10</button>
    <button data-die="12">d12</button>
    <button data-die="20">d20</button>
    <button data-die="100">d&percnt;</button>
    </div>

    <div id="controls">
      <button id="equals">=</button>
      <button id="clear">Clear</button>
      <input id="single-rolls" type="checkbox" checked="true">Single rolls</input>
    </div>

  </body>

  <script>
    /*
          @licstart  The following is the entire license notice for the
          JavaScript code in this page.

          Copyright (C) 2022  Tim Vaughan

          The JavaScript code in this page is free software: you can
          redistribute it and/or modify it under the terms of the GNU
          General Public License (GNU GPL) as published by the Free Software
          Foundation, either version 3 of the License, or (at your option)
          any later version.  The code is distributed WITHOUT ANY WARRANTY;
          without even the implied warranty of MERCHANTABILITY or FITNESS
          FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

          As additional permission under GNU GPL version 3 section 7, you
          may distribute non-source (e.g., minimized or compacted) forms of
          that code without the copy of the GNU GPL normally required by
          section 4, provided you include this license notice and a URL
          through which recipients can access the Corresponding Source.


          @licend  The above is the entire license notice
          for the JavaScript code in this page.
    */

    var current_sum = 0;

    const out = document.querySelector('#output');
    const single_roll_checkbox = document.querySelector('#single-rolls');

    function roll(d) {
        return Math.ceil(Math.random()*d);
    }

    function roll_event(e) {
        if (e.target.tagName != "BUTTON")
            return false;

        var d = e.target.dataset.die*1;
        var result = roll(d);

        if (!single_roll_checkbox.checked) {
            if (current_sum > 0)
                out.value += '+ ';

            current_sum += result;
        }

        out.value += result + '[d' + d + ']';

        if (single_roll_checkbox.checked)
            out.value += '\n';
        else
            out.value += ' ';

        out.scrollTop = out.scrollHeight;
    }

    function clear() {
        current_sum = 0;
        out.value = '';
    }

    function equals() {
        if (current_sum == 0)
            return false;

        out.value += '= ' + current_sum + '\n';
        out.scrollTop = out.scrollHeight;
        current_sum = 0;
    }

    function toggle_single_rolls() {
        if (single_roll_checkbox.checked)
            equals();
    }

    document.querySelector('#roll-buttons').addEventListener('click', roll_event);
    document.querySelector('#clear').addEventListener('click', clear);
    document.querySelector('#equals').addEventListener('click', equals);
    single_roll_checkbox.addEventListener('click', toggle_single_rolls);
  </script>
</html>
